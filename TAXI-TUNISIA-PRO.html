<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ§ÙƒØ³ÙŠ ØªÙˆÙ†Ø³ - Ù…Ù†Ø§ÙØ³ Bolt Ùˆ Indriver</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        * { font-family: 'Cairo', sans-serif; }
        
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .map-container {
            height: 500px;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .driver-marker {
            background: #10b981;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 9999;
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }
        
        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-area:hover {
            border-color: #667eea;
            background: #f7fafc;
        }
        
        .file-upload-area.dragover {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        .price-breakdown {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            border-left: 4px solid #667eea;
        }
        
        .nearby-request {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .rating-star {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .rating-star:hover {
            transform: scale(1.3);
        }
        
        .trip-timeline {
            position: relative;
            padding-right: 2rem;
        }
        
        .trip-timeline::before {
            content: '';
            position: absolute;
            right: 0.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e5e7eb;
        }
        
        .trip-step {
            position: relative;
            padding-bottom: 2rem;
        }
        
        .trip-step::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0.5rem;
            width: 1rem;
            height: 1rem;
            background: white;
            border: 3px solid #667eea;
            border-radius: 50%;
        }
        
        .trip-step.completed::before {
            background: #10b981;
            border-color: #10b981;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ===================================
        // STATE MANAGEMENT - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©
        // ===================================
        const AppState = {
            currentView: 'welcome',
            userType: null,
            isAuthenticated: false,
            currentUser: null,
            
            // Maps
            map: null,
            driverMarker: null,
            passengerMarker: null,
            pickupMarker: null,
            dropoffMarker: null,
            routeLine: null,
            nearbyDriversMarkers: [],
            
            // GPS Tracking
            watchId: null,
            currentPosition: { lat: 36.8065, lng: 10.1815 },
            
            // Ride Data
            pickup: null,
            dropoff: null,
            rideType: 'economy',
            isShared: false,
            paymentMethod: 'cash',
            
            // Active Ride
            activeRide: null,
            rideStatus: 'idle', // idle, searching, accepted, in_progress, completed
            
            // Driver Data
            isOnline: false,
            nearbyRequests: [],
            earnings: { today: 0, week: 0, month: 0 },
            
            // Pricing
            pricingRules: {
                economy: {
                    baseFare: 2.5,      // Ø¯ÙŠÙ†Ø§Ø±
                    perKm: 1.0,         // Ø¯ÙŠÙ†Ø§Ø±/ÙƒÙ…
                    perMinute: 0.2,     // Ø¯ÙŠÙ†Ø§Ø±/Ø¯Ù‚ÙŠÙ‚Ø©
                    minimumFare: 5.0,   // Ø¯ÙŠÙ†Ø§Ø±
                    surgePricing: 1.0   // Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø²Ø­Ø§Ù… (1.0 = Ø¹Ø§Ø¯ÙŠØŒ 1.5 = Ø²Ø­Ø§Ù…)
                },
                comfort: {
                    baseFare: 4.0,
                    perKm: 1.5,
                    perMinute: 0.3,
                    minimumFare: 8.0,
                    surgePricing: 1.0
                },
                premium: {
                    baseFare: 6.0,
                    perKm: 2.0,
                    perMinute: 0.4,
                    minimumFare: 12.0,
                    surgePricing: 1.0
                }
            },
            
            // Database Simulation
            users: [],
            drivers: [],
            rides: [],
            ratings: []
        };

        // ===================================
        // UTILITY FUNCTIONS - Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ===================================
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-yellow-500' :
                'bg-blue-500'
            } text-white`;
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="text-2xl">${
                        type === 'success' ? 'âœ…' : 
                        type === 'error' ? 'âŒ' : 
                        type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'
                    }</span>
                    <span class="font-semibold">${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Ù†ØµÙ Ù‚Ø·Ø± Ø§Ù„Ø£Ø±Ø¶ Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¹ÙŠØ± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ - Ù…Ø«Ù„ Bolt Ùˆ Indriver
        function calculateFare(distance, estimatedTime, rideType, isShared = false) {
            const rules = AppState.pricingRules[rideType];
            
            // Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
            let fare = rules.baseFare + 
                      (distance * rules.perKm) + 
                      (estimatedTime * rules.perMinute);
            
            // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø²Ø­Ø§Ù… (Surge Pricing)
            fare = fare * rules.surgePricing;
            
            // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
            fare = Math.max(fare, rules.minimumFare);
            
            // Ø®ØµÙ… Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
            if (isShared) {
                fare = fare * 0.6; // 40% Ø®ØµÙ…
            }
            
            // ØªÙØµÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±
            return {
                total: parseFloat(fare.toFixed(2)),
                baseFare: rules.baseFare,
                distanceFare: parseFloat((distance * rules.perKm).toFixed(2)),
                timeFare: parseFloat((estimatedTime * rules.perMinute).toFixed(2)),
                surgeFactor: rules.surgePricing,
                discount: isShared ? parseFloat((fare * 0.4).toFixed(2)) : 0
            };
        }
        
        function initMap(containerId, lat, lng, zoom = 13) {
            const map = L.map(containerId).setView([lat, lng], zoom);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap'
            }).addTo(map);
            
            return map;
        }
        
        function addCustomMarker(map, lat, lng, icon, color = '#667eea') {
            const markerHtml = `
                <div class="driver-marker" style="background: ${color};">
                    ${icon}
                </div>
            `;
            
            const customIcon = L.divIcon({
                className: 'custom-div-icon',
                html: markerHtml,
                iconSize: [40, 40]
            });
            
            return L.marker([lat, lng], { icon: customIcon }).addTo(map);
        }
        
        function drawRoute(map, points, color = '#667eea') {
            if (AppState.routeLine) {
                map.removeLayer(AppState.routeLine);
            }
            
            AppState.routeLine = L.polyline(points, {
                color: color,
                weight: 5,
                opacity: 0.7,
                smoothFactor: 1
            }).addTo(map);
            
            map.fitBounds(AppState.routeLine.getBounds(), { padding: [50, 50] });
        }
        
        // Ø¨Ø¯Ø¡ ØªØªØ¨Ø¹ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        function startGPSTracking() {
            if (!navigator.geolocation) {
                showNotification('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… GPS', 'error');
                return;
            }
            
            AppState.watchId = navigator.geolocation.watchPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    AppState.currentPosition = { lat: latitude, lng: longitude };
                    
                    // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                    if (AppState.driverMarker && AppState.map) {
                        AppState.driverMarker.setLatLng([latitude, longitude]);
                        AppState.map.panTo([latitude, longitude]);
                    }
                    
                    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø®Ø§Ø¯Ù… (Ù…Ø­Ø§ÙƒØ§Ø©)
                    updateDriverLocation(latitude, longitude);
                },
                (error) => {
                    console.error('GPS Error:', error);
                    showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                }
            );
        }
        
        function stopGPSTracking() {
            if (AppState.watchId) {
                navigator.geolocation.clearWatch(AppState.watchId);
                AppState.watchId = null;
            }
        }
        
        function updateDriverLocation(lat, lng) {
            // Ù‡Ù†Ø§ Ù†Ø±Ø³Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø®Ø§Ø¯Ù…
            // ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©: API call to update database
            console.log(`Driver location updated: ${lat}, ${lng}`);
        }
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ù‚Ø±ÙŠØ¨ÙŠÙ†
        function findNearbyDrivers(passengerLat, passengerLng, radius = 5) {
            return AppState.drivers.filter(driver => {
                if (!driver.isOnline || !driver.location) return false;
                
                const distance = calculateDistance(
                    passengerLat, passengerLng,
                    driver.location.lat, driver.location.lng
                );
                
                return distance <= radius;
            }).map(driver => ({
                ...driver,
                distanceToPassenger: calculateDistance(
                    passengerLat, passengerLng,
                    driver.location.lat, driver.location.lng
                )
            })).sort((a, b) => a.distanceToPassenger - b.distanceToPassenger);
        }

        // ===================================
        // AUTHENTICATION VIEWS - ÙˆØ§Ø¬Ù‡Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        // ===================================
        
        function WelcomeView() {
            return `
                <div class="min-h-screen gradient-bg flex items-center justify-center p-4">
                    <div class="max-w-4xl w-full">
                        <div class="text-center mb-12">
                            <div class="text-9xl mb-6">ğŸš–</div>
                            <h1 class="text-6xl font-black text-white mb-4">ØªØ§ÙƒØ³ÙŠ ØªÙˆÙ†Ø³</h1>
                            <p class="text-2xl text-white opacity-90 mb-2">Ù…Ù†Ø§ÙØ³ Bolt Ùˆ Indriver</p>
                            <p class="text-lg text-white opacity-75">Ù†Ø¸Ø§Ù… Ø­Ø¬Ø² ØªØ§ÙƒØ³ÙŠ Ù…ØªØ·ÙˆØ± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <button onclick="AppState.currentView = 'login-passenger'; render();" 
                                class="bg-white rounded-3xl shadow-2xl p-8 hover:scale-105 transition transform">
                                <div class="text-6xl mb-4">ğŸ‘¥</div>
                                <h2 class="text-2xl font-bold text-purple-600 mb-2">Ø±Ø§ÙƒØ¨</h2>
                                <p class="text-gray-600">Ø§Ø­Ø¬Ø² Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¢Ù†</p>
                                <div class="mt-4 text-sm text-gray-500">
                                    â€¢ GPS Ø¯Ù‚ÙŠÙ‚<br>
                                    â€¢ ØªØ³Ø¹ÙŠØ± Ø´ÙØ§Ù<br>
                                    â€¢ Ø³Ø§Ø¦Ù‚ÙˆÙ† Ù…Ø­ØªØ±ÙÙˆÙ†
                                </div>
                            </button>
                            
                            <button onclick="AppState.currentView = 'login-driver'; render();" 
                                class="bg-white rounded-3xl shadow-2xl p-8 hover:scale-105 transition transform">
                                <div class="text-6xl mb-4">ğŸš•</div>
                                <h2 class="text-2xl font-bold text-blue-600 mb-2">Ø³Ø§Ø¦Ù‚</h2>
                                <p class="text-gray-600">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ù…Ù„ Ù…Ø¹Ù†Ø§</p>
                                <div class="mt-4 text-sm text-gray-500">
                                    â€¢ Ø·Ù„Ø¨Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©<br>
                                    â€¢ Ø£Ø±Ø¨Ø§Ø­ Ø¹Ø§Ù„ÙŠØ©<br>
                                    â€¢ Ù†Ø¸Ø§Ù… Ø¹Ø§Ø¯Ù„
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function LoginPassengerView() {
            return `
                <div class="min-h-screen gradient-bg flex items-center justify-center p-4">
                    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md">
                        <button onclick="AppState.currentView = 'welcome'; render();" 
                            class="text-gray-600 hover:text-gray-800 mb-4">â† Ø±Ø¬ÙˆØ¹</button>
                        
                        <div class="text-center mb-8">
                            <div class="text-6xl mb-4">ğŸ‘¤</div>
                            <h2 class="text-3xl font-bold mb-2">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø§ÙƒØ¨</h2>
                            <p class="text-gray-600">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
                        </div>
                        
                        <form onsubmit="loginPassenger(event)" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                <input type="tel" id="passengerPhone" required
                                    placeholder="21612345678"
                                    class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                                <input type="text" id="passengerName" required
                                    placeholder="Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù„ÙŠ"
                                    class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none">
                            </div>
                            
                            <button type="submit" 
                                class="w-full gradient-bg text-white p-4 rounded-xl font-bold text-lg hover:shadow-xl transition">
                                Ø¯Ø®ÙˆÙ„ ğŸš€
                            </button>
                        </form>
                        
                        <p class="text-center text-sm text-gray-500 mt-6">
                            Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙƒØŒ Ø£Ù†Øª ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
                        </p>
                    </div>
                </div>
            `;
        }
        
        function LoginDriverView() {
            return `
                <div class="min-h-screen gradient-bg flex items-center justify-center p-4">
                    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                        <button onclick="AppState.currentView = 'welcome'; render();" 
                            class="text-gray-600 hover:text-gray-800 mb-4">â† Ø±Ø¬ÙˆØ¹</button>
                        
                        <div class="text-center mb-8">
                            <div class="text-6xl mb-4">ğŸš•</div>
                            <h2 class="text-3xl font-bold mb-2">ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¦Ù‚ Ø¬Ø¯ÙŠØ¯</h2>
                            <p class="text-gray-600">Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</p>
                        </div>
                        
                        <form onsubmit="registerDriver(event)" class="space-y-6">
                            <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© -->
                            <div class="border-b pb-6">
                                <h3 class="text-xl font-bold mb-4">ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                                        <input type="text" id="driverName" required
                                            placeholder="Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù„ÙŠ"
                                            class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                                        <input type="tel" id="driverPhone" required
                                            placeholder="21612345678"
                                            class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                        <input type="email" id="driverEmail"
                                            placeholder="driver@email.com"
                                            class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                            <div class="border-b pb-6">
                                <h3 class="text-xl font-bold mb-4">ğŸš— Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
                                
                                <div class="space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-semibold mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
                                            <select id="vehicleType" required
                                                class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none">
                                                <option value="economy">Ø§Ù‚ØªØµØ§Ø¯ÙŠ</option>
                                                <option value="comfort">Ù…Ø±ÙŠØ­</option>
                                                <option value="premium">Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-semibold mb-2">Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹ *</label>
                                            <input type="number" id="vehicleYear" required min="2010" max="2026"
                                                placeholder="2020"
                                                class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none">
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-semibold mb-2">Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© *</label>
                                            <input type="text" id="vehicleMake" required
                                                placeholder="Ø¨ÙŠØ¬Ùˆ"
                                                class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-semibold mb-2">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ *</label>
                                            <input type="text" id="vehicleModel" required
                                                placeholder="301"
                                                class="w-full p-3 border-2 border-gray-300 rounded-xl focus:outline-none">
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø© *</label>
                                        <input type="text" id="plateNumber" required
                                            placeholder="123 ØªÙˆÙ†Ø³ 4567"
                                            class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ -->
                            <div class="border-b pb-6">
                                <h3 class="text-xl font-bold mb-4">ğŸ“„ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
                                
                                <div class="space-y-4">
                                    <!-- ØµÙˆØ±Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ -->
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ© *</label>
                                        <div class="file-upload-area" onclick="document.getElementById('driverPhoto').click()">
                                            <div class="text-4xl mb-2">ğŸ“¸</div>
                                            <p class="font-semibold">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
                                            <p class="text-sm text-gray-500 mt-1">PNG, JPG (Max: 5MB)</p>
                                            <input type="file" id="driverPhoto" accept="image/*" class="hidden" 
                                                onchange="handleFileUpload(this, 'driverPhotoPreview')">
                                        </div>
                                        <div id="driverPhotoPreview" class="mt-2"></div>
                                    </div>
                                    
                                    <!-- Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ù‚Ø© -->
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ù‚Ø© *</label>
                                        <input type="text" id="licenseNumber" required
                                            placeholder="Ø±Ù‚Ù… Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ù‚Ø©"
                                            class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none mb-2">
                                        <div class="file-upload-area" onclick="document.getElementById('licensePhoto').click()">
                                            <div class="text-4xl mb-2">ğŸªª</div>
                                            <p class="font-semibold">ØµÙˆØ±Ø© Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ù‚Ø©</p>
                                            <input type="file" id="licensePhoto" accept="image/*" class="hidden"
                                                onchange="handleFileUpload(this, 'licensePhotoPreview')">
                                        </div>
                                        <div id="licensePhotoPreview" class="mt-2"></div>
                                    </div>
                                    
                                    <!-- Ø±Ø®ØµØ© Ø§Ù„ØªØ§ÙƒØ³ÙŠ -->
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">Ø±Ø®ØµØ© Ø§Ù„ØªØ§ÙƒØ³ÙŠ *</label>
                                        <input type="text" id="taxiLicenseNumber" required
                                            placeholder="Ø±Ù‚Ù… Ø±Ø®ØµØ© Ø§Ù„ØªØ§ÙƒØ³ÙŠ"
                                            class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none mb-2">
                                        <div class="file-upload-area" onclick="document.getElementById('taxiLicensePhoto').click()">
                                            <div class="text-4xl mb-2">ğŸš–</div>
                                            <p class="font-semibold">ØµÙˆØ±Ø© Ø±Ø®ØµØ© Ø§Ù„ØªØ§ÙƒØ³ÙŠ</p>
                                            <input type="file" id="taxiLicensePhoto" accept="image/*" class="hidden"
                                                onchange="handleFileUpload(this, 'taxiLicensePhotoPreview')">
                                        </div>
                                        <div id="taxiLicensePhotoPreview" class="mt-2"></div>
                                    </div>
                                    
                                    <!-- ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                                    <div>
                                        <label class="block text-sm font-semibold mb-2">ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
                                        <div class="file-upload-area" onclick="document.getElementById('vehiclePhoto').click()">
                                            <div class="text-4xl mb-2">ğŸš—</div>
                                            <p class="font-semibold">ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ø³ÙŠØ§Ø±Ø©</p>
                                            <input type="file" id="vehiclePhoto" accept="image/*" class="hidden"
                                                onchange="handleFileUpload(this, 'vehiclePhotoPreview')">
                                        </div>
                                        <div id="vehiclePhotoPreview" class="mt-2"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" 
                                class="w-full bg-gradient-to-r from-blue-500 to-blue-700 text-white p-4 rounded-xl font-bold text-lg hover:shadow-xl transition">
                                ØªØ³Ø¬ÙŠÙ„ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ ğŸš€
                            </button>
                            
                            <p class="text-center text-sm text-gray-500">
                                Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©
                            </p>
                        </form>
                    </div>
                </div>
            `;
        }

        // ===================================
        // PASSENGER VIEW - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø§ÙƒØ¨
        // ===================================
        
        function PassengerView() {
            const fareDetails = AppState.fareEstimate;
            
            return `
                <div class="min-h-screen bg-gray-100">
                    <!-- Header -->
                    <header class="gradient-bg text-white shadow-lg">
                        <div class="container mx-auto px-4 py-4">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <button onclick="logout()" class="hover:bg-white/20 p-2 rounded-lg transition">
                                        ğŸšª Ø®Ø±ÙˆØ¬
                                    </button>
                                    <div>
                                        <h1 class="text-xl font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ ${AppState.currentUser?.name || 'Ø±Ø§ÙƒØ¨'}</h1>
                                        <p class="text-sm opacity-90">ğŸ“ ${AppState.currentPosition.lat.toFixed(4)}, ${AppState.currentPosition.lng.toFixed(4)}</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-4">
                                    <div class="bg-white/20 px-4 py-2 rounded-full">
                                        â­ ${AppState.currentUser?.rating || '5.0'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div class="container mx-auto px-4 py-6">
                        <div class="grid lg:grid-cols-3 gap-6">
                            <!-- Main Panel -->
                            <div class="lg:col-span-2 space-y-6">
                                <!-- Map -->
                                <div class="bg-white rounded-2xl shadow-xl p-6">
                                    <div class="flex justify-between items-center mb-4">
                                        <h2 class="text-2xl font-bold">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h2>
                                        <button onclick="getCurrentLocation()" 
                                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition">
                                            ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ
                                        </button>
                                    </div>
                                    
                                    <div id="passengerMap" class="map-container"></div>
                                    
                                    <div class="grid grid-cols-2 gap-3 mt-4">
                                        <button onclick="setPickupMode()" 
                                            class="bg-green-500 hover:bg-green-600 text-white p-3 rounded-xl font-bold transition">
                                            ğŸŸ¢ Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚
                                        </button>
                                        <button onclick="setDropoffMode()" 
                                            class="bg-red-500 hover:bg-red-600 text-white p-3 rounded-xl font-bold transition">
                                            ğŸ”´ Ø§Ù„ÙˆØ¬Ù‡Ø©
                                        </button>
                                    </div>
                                </div>

                                <!-- Booking Form -->
                                ${AppState.rideStatus === 'idle' ? `
                                    <div class="bg-white rounded-2xl shadow-xl p-6">
                                        <h2 class="text-2xl font-bold mb-6">ğŸ¯ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø©</h2>
                                        
                                        <!-- Ride Type -->
                                        <div class="mb-6">
                                            <h3 class="font-bold mb-3">Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
                                            <div class="grid grid-cols-3 gap-3">
                                                ${['economy', 'comfort', 'premium'].map(type => `
                                                    <button onclick="AppState.rideType = '${type}'; calculateFareEstimate(); render();"
                                                        class="p-4 rounded-xl border-2 transition ${AppState.rideType === type ? 'border-purple-600 bg-purple-100' : 'border-gray-300'}">
                                                        <div class="text-2xl mb-2">${type === 'economy' ? 'ğŸš•' : type === 'comfort' ? 'ğŸš™' : 'ğŸš—'}</div>
                                                        <div class="font-bold text-sm">${type === 'economy' ? 'Ø§Ù‚ØªØµØ§Ø¯ÙŠ' : type === 'comfort' ? 'Ù…Ø±ÙŠØ­' : 'Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…'}</div>
                                                        <div class="text-xs text-gray-600 mt-1">
                                                            ${AppState.pricingRules[type].perKm} Ø¯Øª/ÙƒÙ…
                                                        </div>
                                                    </button>
                                                `).join('')}
                                            </div>
                                        </div>

                                        <!-- Shared Ride -->
                                        <label class="flex items-center gap-3 p-4 bg-green-50 rounded-xl cursor-pointer mb-6">
                                            <input type="checkbox" ${AppState.isShared ? 'checked' : ''}
                                                onchange="AppState.isShared = this.checked; calculateFareEstimate(); render();"
                                                class="w-6 h-6">
                                            <div class="flex-1">
                                                <div class="font-semibold">ğŸ‘¥ Ø±Ø­Ù„Ø© Ù…Ø´ØªØ±ÙƒØ©</div>
                                                <div class="text-sm text-gray-600">ÙˆÙÙ‘Ø± 40%</div>
                                            </div>
                                            <div class="text-xl font-bold text-green-600">-40%</div>
                                        </label>

                                        <!-- Payment -->
                                        <div class="mb-6">
                                            <h3 class="font-bold mb-3">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
                                            <div class="grid grid-cols-2 gap-3">
                                                ${['cash', 'card'].map(method => `
                                                    <button onclick="AppState.paymentMethod = '${method}'; render();"
                                                        class="p-4 rounded-xl border-2 transition ${AppState.paymentMethod === method ? 'bg-green-100 border-green-500' : 'border-gray-300'}">
                                                        <div class="text-2xl mb-2">${method === 'cash' ? 'ğŸ’µ' : 'ğŸ’³'}</div>
                                                        <div class="font-semibold">${method === 'cash' ? 'Ù†Ù‚Ø¯ÙŠ' : 'Ø¨Ø·Ø§Ù‚Ø©'}</div>
                                                    </button>
                                                `).join('')}
                                            </div>
                                        </div>

                                        <!-- Fare Estimate -->
                                        ${fareDetails ? `
                                            <div class="price-breakdown p-6 rounded-xl mb-6">
                                                <h3 class="font-bold text-lg mb-4">ğŸ’° ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±</h3>
                                                
                                                <div class="space-y-3">
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-600">Ø§Ù„ØªØ¹Ø±ÙŠÙØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
                                                        <span class="font-semibold">${fareDetails.baseFare} Ø¯Øª</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-600">Ø§Ù„Ù…Ø³Ø§ÙØ© (${AppState.fareEstimate.distance} ÙƒÙ…)</span>
                                                        <span class="font-semibold">${fareDetails.distanceFare} Ø¯Øª</span>
                                                    </div>
                                                    <div class="flex justify-between">
                                                        <span class="text-gray-600">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (${AppState.fareEstimate.estimatedTime} Ø¯Ù‚ÙŠÙ‚Ø©)</span>
                                                        <span class="font-semibold">${fareDetails.timeFare} Ø¯Øª</span>
                                                    </div>
                                                    ${fareDetails.surgeFactor > 1 ? `
                                                        <div class="flex justify-between text-orange-600">
                                                            <span>âš¡ Ø²Ø­Ø§Ù… Ù…Ø±ÙˆØ±ÙŠ</span>
                                                            <span class="font-semibold">Ã—${fareDetails.surgeFactor}</span>
                                                        </div>
                                                    ` : ''}
                                                    ${fareDetails.discount > 0 ? `
                                                        <div class="flex justify-between text-green-600">
                                                            <span>Ø®ØµÙ… Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©</span>
                                                            <span class="font-semibold">-${fareDetails.discount} Ø¯Øª</span>
                                                        </div>
                                                    ` : ''}
                                                    
                                                    <div class="border-t-2 border-gray-300 pt-3 mt-3">
                                                        <div class="flex justify-between items-center">
                                                            <span class="text-xl font-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                                                            <span class="text-3xl font-bold text-purple-600">${fareDetails.total} Ø¯Øª</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ` : ''}

                                        <!-- Actions -->
                                        <div class="grid grid-cols-2 gap-3">
                                            <button onclick="calculateFareEstimate()" 
                                                class="bg-gray-500 hover:bg-gray-600 text-white p-4 rounded-xl font-bold transition">
                                                ğŸ’° Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±
                                            </button>
                                            <button onclick="requestRide()" 
                                                class="gradient-bg text-white p-4 rounded-xl font-bold shadow-lg hover:shadow-xl transition">
                                                ğŸš€ Ø§Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†
                                            </button>
                                        </div>
                                    </div>
                                ` : ''}

                                <!-- Active Ride -->
                                ${AppState.rideStatus !== 'idle' ? `
                                    <div class="bg-white rounded-2xl shadow-xl p-6">
                                        <h2 class="text-2xl font-bold mb-6">ğŸš— Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ù†Ø´Ø·Ø©</h2>
                                        
                                        <div class="space-y-6">
                                            <!-- Status -->
                                            <div class="bg-blue-100 p-4 rounded-xl text-center">
                                                <div class="text-4xl mb-2">
                                                    ${AppState.rideStatus === 'searching' ? 'ğŸ”' : 
                                                      AppState.rideStatus === 'accepted' ? 'ğŸš—' : 
                                                      AppState.rideStatus === 'in_progress' ? 'âœ…' : 'ğŸ‰'}
                                                </div>
                                                <div class="font-bold text-xl">
                                                    ${AppState.rideStatus === 'searching' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚...' : 
                                                      AppState.rideStatus === 'accepted' ? 'Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø¥Ù„ÙŠÙƒ!' : 
                                                      AppState.rideStatus === 'in_progress' ? 'Ø§Ù„Ø±Ø­Ù„Ø© Ø¬Ø§Ø±ÙŠØ©' : 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø±Ø­Ù„Ø©!'}
                                                </div>
                                            </div>

                                            ${AppState.activeRide?.driver ? `
                                                <!-- Driver Info -->
                                                <div class="border-2 border-gray-200 rounded-xl p-4">
                                                    <h3 class="font-bold mb-3">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚</h3>
                                                    <div class="flex items-center gap-4">
                                                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                                                            ${AppState.activeRide.driver.name.charAt(0)}
                                                        </div>
                                                        <div class="flex-1">
                                                            <div class="font-bold text-lg">${AppState.activeRide.driver.name}</div>
                                                            <div class="text-yellow-600">â­ ${AppState.activeRide.driver.rating}</div>
                                                            <div class="text-sm text-gray-600">${AppState.activeRide.driver.vehicle}</div>
                                                        </div>
                                                        <a href="tel:${AppState.activeRide.driver.phone}" 
                                                            class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-full transition">
                                                            ğŸ“
                                                        </a>
                                                    </div>
                                                </div>
                                            ` : ''}

                                            <button onclick="cancelRide()" 
                                                class="w-full bg-red-500 hover:bg-red-600 text-white p-4 rounded-xl font-bold transition">
                                                âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©
                                            </button>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- Sidebar -->
                            <div class="space-y-6">
                                <!-- Nearby Drivers -->
                                <div class="bg-white rounded-2xl shadow-xl p-6">
                                    <h3 class="text-xl font-bold mb-4">ğŸš• Ø³Ø§Ø¦Ù‚ÙˆÙ† Ù‚Ø±ÙŠØ¨ÙˆÙ†</h3>
                                    <div id="nearbyDriversList" class="space-y-3">
                                        <p class="text-center text-gray-500 text-sm">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</p>
                                    </div>
                                </div>

                                <!-- Promo -->
                                <div class="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl shadow-xl p-6 text-white">
                                    <div class="text-4xl mb-3">ğŸ</div>
                                    <h3 class="text-xl font-bold mb-2">Ø¹Ø±Ø¶ Ø®Ø§Øµ!</h3>
                                    <p class="mb-4">Ø®ØµÙ… 20% Ø¹Ù„Ù‰ Ø£ÙˆÙ„ 3 Ø±Ø­Ù„Ø§Øª</p>
                                    <div class="bg-white/30 backdrop-blur p-3 rounded-xl text-center">
                                        <div class="text-sm font-semibold">Ø§Ù„ÙƒÙˆØ¯</div>
                                        <div class="text-2xl font-bold">TAXI20</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ===================================
        // DRIVER VIEW - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚
        // ===================================
        
        function DriverView() {
            return `
                <div class="min-h-screen bg-gray-100">
                    <header class="gradient-bg text-white shadow-lg">
                        <div class="container mx-auto px-4 py-4">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <button onclick="logout()" class="hover:bg-white/20 p-2 rounded-lg transition">
                                        ğŸšª Ø®Ø±ÙˆØ¬
                                    </button>
                                    <div>
                                        <h1 class="text-xl font-bold">${AppState.currentUser?.name || 'Ø³Ø§Ø¦Ù‚'}</h1>
                                        <div class="flex items-center gap-2">
                                            <div class="w-3 h-3 rounded-full ${AppState.isOnline ? 'bg-green-500' : 'bg-red-500'}"></div>
                                            <span class="text-sm">${AppState.isOnline ? 'Ù…ØªØµÙ„' : 'ØºÙŠØ± Ù…ØªØµÙ„'}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-4">
                                    <div class="text-right">
                                        <div class="text-2xl font-bold">${AppState.earnings.today.toFixed(1)} Ø¯Øª</div>
                                        <div class="text-sm opacity-90">Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div class="container mx-auto px-4 py-6">
                        <!-- Stats -->
                        <div class="grid grid-cols-4 gap-4 mb-6">
                            ${[
                                { label: 'Ø±Ø­Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…', value: AppState.currentUser?.stats?.todayRides || 0, icon: 'ğŸ“Š' },
                                { label: 'Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', value: (AppState.earnings.week).toFixed(0) + ' Ø¯Øª', icon: 'ğŸ’°' },
                                { label: 'Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', value: AppState.currentUser?.rating || 5.0, icon: 'â­' },
                                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø­Ù„Ø§Øª', value: AppState.currentUser?.stats?.totalRides || 0, icon: 'ğŸ¯' }
                            ].map(stat => `
                                <div class="bg-white rounded-xl p-4 shadow-lg text-center">
                                    <div class="text-3xl mb-2">${stat.icon}</div>
                                    <div class="text-2xl font-bold text-purple-600">${stat.value}</div>
                                    <div class="text-sm text-gray-600">${stat.label}</div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="grid lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2 space-y-6">
                                <!-- Online Toggle -->
                                <div class="bg-white rounded-2xl shadow-xl p-6">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <h3 class="text-2xl font-bold mb-2">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</h3>
                                            <p class="text-gray-600">${AppState.isOnline ? 'ØªØ³ØªÙ‚Ø¨Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¢Ù†' : 'ØºÙŠØ± Ù…ØªØµÙ„'}</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" ${AppState.isOnline ? 'checked' : ''}
                                                onchange="toggleDriverOnline()" class="sr-only peer">
                                            <div class="w-20 h-10 bg-gray-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:right-[2px] after:bg-white after:rounded-full after:h-9 after:w-9 after:transition-all peer-checked:bg-green-500"></div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Nearby Requests -->
                                ${AppState.isOnline ? `
                                    <div class="bg-white rounded-2xl shadow-xl p-6">
                                        <h3 class="text-2xl font-bold mb-4">ğŸ“ Ø·Ù„Ø¨Ø§Øª Ù‚Ø±ÙŠØ¨Ø© Ù…Ù†Ùƒ</h3>
                                        
                                        <div class="space-y-4" id="nearbyRequestsList">
                                            ${AppState.nearbyRequests.length > 0 ? 
                                                AppState.nearbyRequests.map(req => `
                                                    <div class="nearby-request border-2 border-purple-300 rounded-xl p-4 bg-purple-50">
                                                        <div class="flex justify-between items-start mb-3">
                                                            <div>
                                                                <div class="text-xl font-bold">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ğŸ¯</div>
                                                                <div class="text-gray-600">ğŸ’° ${req.fare} Ø¯Øª â€¢ ğŸ“ ${req.distance} ÙƒÙ…</div>
                                                            </div>
                                                            <div class="bg-purple-600 text-white px-3 py-1 rounded-full font-bold text-sm">
                                                                ${req.distanceToDriver.toFixed(1)} ÙƒÙ… Ù…Ù†Ùƒ
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="space-y-2 mb-4">
                                                            <div class="flex items-start gap-2 p-2 bg-green-100 rounded-lg">
                                                                <span>ğŸŸ¢</span>
                                                                <span class="text-sm">${req.pickup}</span>
                                                            </div>
                                                            <div class="flex items-start gap-2 p-2 bg-red-100 rounded-lg">
                                                                <span>ğŸ”´</span>
                                                                <span class="text-sm">${req.dropoff}</span>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="grid grid-cols-2 gap-3">
                                                            <button onclick="acceptRide(${req.id})" 
                                                                class="bg-green-500 hover:bg-green-600 text-white p-3 rounded-xl font-bold transition">
                                                                âœ… Ù‚Ø¨ÙˆÙ„
                                                            </button>
                                                            <button onclick="rejectRide(${req.id})" 
                                                                class="bg-gray-300 hover:bg-gray-400 text-gray-700 p-3 rounded-xl font-bold transition">
                                                                âŒ ØªØ¬Ø§Ù‡Ù„
                                                            </button>
                                                        </div>
                                                    </div>
                                                `).join('') 
                                                : '<p class="text-center text-gray-500 py-8">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ù„Ø¨Ø§Øª Ù‚Ø±ÙŠØ¨Ø©...</p>'
                                            }
                                        </div>
                                    </div>
                                ` : `
                                    <div class="bg-white rounded-2xl shadow-xl p-12 text-center">
                                        <div class="text-6xl mb-4">ğŸ˜´</div>
                                        <h3 class="text-2xl font-bold mb-2">ØºÙŠØ± Ù…ØªØµÙ„</h3>
                                        <p class="text-gray-600 mb-6">ÙØ¹Ù‘Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                                        <button onclick="toggleDriverOnline()" 
                                            class="gradient-bg text-white px-8 py-4 rounded-xl font-bold text-lg transition">
                                            ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ù…Ù„
                                        </button>
                                    </div>
                                `}

                                <!-- GPS Map -->
                                <div class="bg-white rounded-2xl shadow-xl p-6">
                                    <h3 class="text-xl font-bold mb-4">ğŸ—ºï¸ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ (GPS)</h3>
                                    <div id="driverMap" class="map-container"></div>
                                    <div class="mt-4 flex justify-between items-center text-sm">
                                        <span class="text-gray-600">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ø¢Ù†</span>
                                        <span class="text-green-600 font-semibold">â— GPS Ù†Ø´Ø·</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Sidebar -->
                            <div class="space-y-6">
                                <!-- Earnings Breakdown -->
                                <div class="bg-white rounded-2xl shadow-xl p-6">
                                    <h3 class="text-xl font-bold mb-4">ğŸ’µ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
                                    <div class="space-y-3">
                                        <div class="flex justify-between p-3 bg-green-50 rounded-lg">
                                            <span>Ø§Ù„ÙŠÙˆÙ…</span>
                                            <span class="font-bold">${AppState.earnings.today.toFixed(1)} Ø¯Øª</span>
                                        </div>
                                        <div class="flex justify-between p-3 bg-blue-50 rounded-lg">
                                            <span>Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span>
                                            <span class="font-bold">${AppState.earnings.week.toFixed(0)} Ø¯Øª</span>
                                        </div>
                                        <div class="flex justify-between p-3 bg-purple-50 rounded-lg">
                                            <span>Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</span>
                                            <span class="font-bold">${AppState.earnings.month.toFixed(0)} Ø¯Øª</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tips -->
                                <div class="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-2xl shadow-xl p-6 text-white">
                                    <div class="text-4xl mb-3">ğŸ’¡</div>
                                    <h3 class="text-xl font-bold mb-3">Ù†ØµØ§Ø¦Ø­</h3>
                                    <ul class="space-y-2 text-sm">
                                        <li>âœ… Ø§Ø¨Ù‚ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ø²Ø¯Ø­Ù…Ø©</li>
                                        <li>âœ… Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ùƒ ÙÙˆÙ‚ 4.5</li>
                                        <li>âœ… ØªØ¬Ù†Ø¨ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ===================================
        // EVENT HANDLERS - Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        // ===================================
        
        function handleFileUpload(input, previewId) {
            const file = input.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB)', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById(previewId);
                preview.innerHTML = `
                    <div class="relative inline-block">
                        <img src="${e.target.result}" class="w-32 h-32 object-cover rounded-lg border-2 border-green-500">
                        <div class="absolute top-0 right-0 bg-green-500 text-white rounded-full p-1">
                            âœ“
                        </div>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
            
            showNotification('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…', 'success');
        }
        
        function loginPassenger(event) {
            event.preventDefault();
            
            const phone = document.getElementById('passengerPhone').value;
            const name = document.getElementById('passengerName').value;
            
            AppState.currentUser = {
                id: Date.now(),
                phone,
                name,
                type: 'passenger',
                rating: 5.0,
                ridesCount: 0
            };
            
            AppState.isAuthenticated = true;
            AppState.currentView = 'passenger';
            
            showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name}! ğŸ‘‹`, 'success');
            render();
            
            setTimeout(() => {
                if (!AppState.map) {
                    getCurrentLocation();
                    initPassengerMap();
                }
            }, 100);
        }
        
        function registerDriver(event) {
            event.preventDefault();
            
            const driver = {
                id: Date.now(),
                name: document.getElementById('driverName').value,
                phone: document.getElementById('driverPhone').value,
                email: document.getElementById('driverEmail').value,
                vehicle: {
                    type: document.getElementById('vehicleType').value,
                    make: document.getElementById('vehicleMake').value,
                    model: document.getElementById('vehicleModel').value,
                    year: document.getElementById('vehicleYear').value,
                    plate: document.getElementById('plateNumber').value
                },
                licenseNumber: document.getElementById('licenseNumber').value,
                taxiLicenseNumber: document.getElementById('taxiLicenseNumber').value,
                type: 'driver',
                rating: 5.0,
                isOnline: false,
                verified: true, // ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ØªÙƒÙˆÙ† false Ø­ØªÙ‰ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
                stats: {
                    todayRides: 0,
                    totalRides: 0
                }
            };
            
            AppState.currentUser = driver;
            AppState.drivers.push(driver);
            AppState.isAuthenticated = true;
            AppState.currentView = 'driver';
            
            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¢Ù† ğŸ‰', 'success');
            render();
            
            setTimeout(() => {
                initDriverMap();
            }, 100);
        }
        
        function logout() {
            if (AppState.isOnline) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                return;
            }
            
            stopGPSTracking();
            AppState.isAuthenticated = false;
            AppState.currentUser = null;
            AppState.currentView = 'welcome';
            render();
        }
        
function initPassengerMap() {
    // 1. Ø£Ù‡Ù… ØªØ¹Ø¯ÙŠÙ„: Ø­Ø°Ù Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡
    if (AppState.map) {
        AppState.map.remove();
        AppState.map = null;
    }

    const { lat, lng } = AppState.currentPosition;
    
    // 2. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    AppState.map = initMap('passengerMap', lat, lng);
    
    // 3. Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø±Ø§ÙƒØ¨
    AppState.passengerMarker = addCustomMarker(AppState.map, lat, lng, 'ğŸ‘¤', '#10b981');
    
    // 4. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
    AppState.map.on('click', function(e) {
        if (AppState.mapMode === 'pickup') {
            if (AppState.pickupMarker) AppState.map.removeLayer(AppState.pickupMarker);
            AppState.pickupMarker = addCustomMarker(AppState.map, e.latlng.lat, e.latlng.lng, 'ğŸŸ¢', '#10b981');
            AppState.pickup = { lat: e.latlng.lat, lng: e.latlng.lng };
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ âœ…', 'success');
        } else if (AppState.mapMode === 'dropoff') {
            if (AppState.dropoffMarker) AppState.map.removeLayer(AppState.dropoffMarker);
            AppState.dropoffMarker = addCustomMarker(AppState.map, e.latlng.lat, e.latlng.lng, 'ğŸ”´', '#ef4444');
            AppState.dropoff = { lat: e.latlng.lat, lng: e.latlng.lng };
            
            if (AppState.pickup) {
                drawRoute(AppState.map, [
                    [AppState.pickup.lat, AppState.pickup.lng],
                    [AppState.dropoff.lat, AppState.dropoff.lng]
                ]);
            }
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ¬Ù‡Ø© âœ…', 'success');
        }
    });

    // 5. ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
    updateNearbyDrivers();
}
                    
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ¬Ù‡Ø© âœ…', 'success');
                }
            });
            
            // Show nearby drivers
            updateNearbyDrivers();
        }
        
        function initDriverMap() {
            const { lat, lng } = AppState.currentPosition;
            AppState.map = initMap('driverMap', lat, lng);
            
            AppState.driverMarker = addCustomMarker(AppState.map, lat, lng, 'ğŸš•', '#10b981');
            
            startGPSTracking();
        }
        
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        AppState.currentPosition = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        AppState.pickup = { ...AppState.currentPosition };
                        
                        if (AppState.map) {
                            AppState.map.setView([AppState.currentPosition.lat, AppState.currentPosition.lng], 15);
                            
                            if (AppState.passengerMarker) {
                                AppState.passengerMarker.setLatLng([AppState.currentPosition.lat, AppState.currentPosition.lng]);
                            } else {
                                AppState.passengerMarker = addCustomMarker(
                                    AppState.map, 
                                    AppState.currentPosition.lat, 
                                    AppState.currentPosition.lng, 
                                    'ğŸ‘¤', 
                                    '#10b981'
                                );
                            }
                        } else {
                            initPassengerMap();
                        }
                        
                        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ âœ…', 'success');
                        render();
                    },
                    (error) => {
                        showNotification('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª.', 'error');
                    }
                );
            }
        }
        
        function setPickupMode() {
            AppState.mapMode = 'pickup';
            showNotification('Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ ğŸŸ¢', 'info');
        }
        
        function setDropoffMode() {
            AppState.mapMode = 'dropoff';
            showNotification('Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ¬Ù‡Ø© ğŸ”´', 'info');
        }
        
        function calculateFareEstimate() {
            if (!AppState.pickup || !AppState.dropoff) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ ÙˆØ§Ù„ÙˆØ¬Ù‡Ø©', 'warning');
                return;
            }
            
            const distance = calculateDistance(
                AppState.pickup.lat, AppState.pickup.lng,
                AppState.dropoff.lat, AppState.dropoff.lng
            );
            
            const estimatedTime = Math.ceil(distance / 0.5); // 30 km/h average
            
            const fareDetails = calculateFare(distance, estimatedTime, AppState.rideType, AppState.isShared);
            
            AppState.fareEstimate = {
                ...fareDetails,
                distance: distance.toFixed(2),
                estimatedTime
            };
            
            showNotification('ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© âœ…', 'success');
            render();
        }
        
        function requestRide() {
            if (!AppState.pickup || !AppState.dropoff) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚ ÙˆØ§Ù„ÙˆØ¬Ù‡Ø©', 'warning');
                return;
            }
            
            if (!AppState.fareEstimate) {
                calculateFareEstimate();
                return;
            }
            
            AppState.rideStatus = 'searching';
            showNotification('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚... ğŸ”', 'info');
            render();
            
            // Simulate finding driver
            setTimeout(() => {
                const nearbyDrivers = findNearbyDrivers(AppState.pickup.lat, AppState.pickup.lng);
                
                if (nearbyDrivers.length > 0) {
                    const driver = nearbyDrivers[0];
                    AppState.activeRide = {
                        id: Date.now(),
                        driver: {
                            name: driver.name || 'Ø§Ù„Ø³Ø§Ø¦Ù‚',
                            phone: driver.phone || '21612345678',
                            rating: driver.rating || 5.0,
                            vehicle: `${driver.vehicle?.make || 'Ø¨ÙŠØ¬Ùˆ'} ${driver.vehicle?.model || '301'}`,
                            plate: driver.vehicle?.plate || '123 ØªÙˆÙ†Ø³ 4567'
                        },
                        fare: AppState.fareEstimate.total
                    };
                    
                    AppState.rideStatus = 'accepted';
                    showNotification('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³Ø§Ø¦Ù‚! ğŸ‰', 'success');
                } else {
                    showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø§Ø¦Ù‚ÙˆÙ† Ù…ØªØ§Ø­ÙˆÙ† Ø§Ù„Ø¢Ù†', 'error');
                    AppState.rideStatus = 'idle';
                }
                
                render();
            }, 3000);
        }
        
        function cancelRide() {
            if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©ØŸ')) return;
            
            AppState.activeRide = null;
            AppState.rideStatus = 'idle';
            showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©', 'info');
            render();
        }
        
        function toggleDriverOnline() {
            AppState.isOnline = !AppState.isOnline;
            
            if (AppState.isOnline) {
                AppState.currentUser.isOnline = true;
                AppState.currentUser.location = AppState.currentPosition;
                
                if (!AppState.drivers.find(d => d.id === AppState.currentUser.id)) {
                    AppState.drivers.push(AppState.currentUser);
                }
                
                startGPSTracking();
                showNotification('Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ù…ØªØµÙ„! Ø³ØªØ¨Ø¯Ø£ Ø¨Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ğŸš—', 'success');
                
                // Simulate incoming request
                setTimeout(() => {
                    simulateIncomingRequest();
                }, 5000);
            } else {
                AppState.currentUser.isOnline = false;
                AppState.nearbyRequests = [];
                stopGPSTracking();
                showNotification('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§ØªØµØ§Ù„', 'info');
            }
            
            render();
        }
        
        function simulateIncomingRequest() {
            if (!AppState.isOnline) return;
            
            const request = {
                id: Date.now(),
                pickup: 'Ø´Ø§Ø±Ø¹ Ø§Ù„Ø­Ø¨ÙŠØ¨ Ø¨ÙˆØ±Ù‚ÙŠØ¨Ø©ØŒ ØªÙˆÙ†Ø³',
                dropoff: 'Ø§Ù„Ù…Ø±Ø³Ù‰ØŒ ØªÙˆÙ†Ø³',
                distance: 5.2,
                fare: 12.5,
                distanceToDriver: 2.3,
                passenger: {
                    name: 'Ø£Ø­Ù…Ø¯',
                    rating: 4.8
                }
            };
            
            AppState.nearbyRequests.push(request);
            showNotification('Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù‚Ø±ÙŠØ¨ Ù…Ù†Ùƒ! ğŸ””', 'info');
            render();
        }
        
        function acceptRide(requestId) {
            AppState.nearbyRequests = AppState.nearbyRequests.filter(r => r.id !== requestId);
            
            const rideEarning = 12.5 * 0.8; // 80% Ù„Ù„Ø³Ø§Ø¦Ù‚
            AppState.earnings.today += rideEarning;
            AppState.earnings.week += rideEarning;
            AppState.earnings.month += rideEarning;
            
            if (AppState.currentUser.stats) {
                AppState.currentUser.stats.todayRides++;
                AppState.currentUser.stats.totalRides++;
            }
            
            showNotification('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨! ğŸ‰', 'success');
            render();
        }
        
        function rejectRide(requestId) {
            AppState.nearbyRequests = AppState.nearbyRequests.filter(r => r.id !== requestId);
            render();
        }
        
        function updateNearbyDrivers() {
            if (!AppState.pickup) return;
            
            const nearby = findNearbyDrivers(AppState.pickup.lat, AppState.pickup.lng);
            
            const listEl = document.getElementById('nearbyDriversList');
            if (!listEl) return;
            
            if (nearby.length === 0) {
                listEl.innerHTML = '<p class="text-center text-gray-500 text-sm">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø§Ø¦Ù‚ÙˆÙ† Ù‚Ø±ÙŠØ¨ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
            } else {
                listEl.innerHTML = nearby.slice(0, 3).map(driver => `
                    <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold">
                            ${driver.name?.charAt(0) || 'Ø³'}
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold">${driver.name || 'Ø³Ø§Ø¦Ù‚'}</div>
                            <div class="text-xs text-gray-600">â­ ${driver.rating || 5.0} â€¢ ${driver.distanceToPassenger.toFixed(1)} ÙƒÙ…</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // ===================================
        // RENDER - Ø§Ù„Ø¹Ø±Ø¶
        // ===================================
        
        function render() {
            const app = document.getElementById('app');
            
            let html = '';
            
            if (!AppState.isAuthenticated) {
                switch(AppState.currentView) {
                    case 'welcome':
                        html = WelcomeView();
                        break;
                    case 'login-passenger':
                        html = LoginPassengerView();
                        break;
                    case 'login-driver':
                        html = LoginDriverView();
                        break;
                    default:
                        html = WelcomeView();
                }
            } else {
                switch(AppState.currentUser?.type) {
                    case 'passenger':
                        html = PassengerView();
                        break;
                    case 'driver':
                        html = DriverView();
                        break;
                    default:
                        html = WelcomeView();
                }
            }
            
            app.innerHTML = html;
            
            // Re-initialize maps if needed
            if (AppState.isAuthenticated && AppState.map) {
                setTimeout(() => {
                    if (AppState.currentUser?.type === 'driver' && document.getElementById('driverMap')) {
                        if (!AppState.map._container) {
                            initDriverMap();
                        }
                    } else if (AppState.currentUser?.type === 'passenger' && document.getElementById('passengerMap')) {
                        if (!AppState.map._container) {
                            initPassengerMap();
                        }
                    }
                }, 100);
            }
        }

        // ===================================
        // INIT - Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        // ===================================
        
        // Add some demo drivers
        for (let i = 0; i < 5; i++) {
            const lat = 36.8065 + (Math.random() - 0.5) * 0.05;
            const lng = 10.1815 + (Math.random() - 0.5) * 0.05;
            
            AppState.drivers.push({
                id: 1000 + i,
                name: ['Ù…Ø­Ù…Ø¯', 'Ø£Ø­Ù…Ø¯', 'Ø¹Ù„ÙŠ', 'Ø³Ø§Ù…ÙŠ', 'ÙƒØ±ÙŠÙ…'][i],
                rating: 4.5 + Math.random() * 0.5,
                isOnline: Math.random() > 0.5,
                location: { lat, lng },
                vehicle: {
                    make: 'Ø¨ÙŠØ¬Ùˆ',
                    model: '301',
                    type: 'economy'
                }
            });
        }
        
        render();
    </script>
</body>
</html>
